{% extends 'guest/base.html.twig' %}

{% block main %}
	<div class="btn-back">
		<a href="{{ path('list-messages') }}" class="btn btn-primary mb-3">Retour à la liste des messages</a>
	</div>
	<div class="container">
		<h1 class="text-center mb-4">Message</h1>

		{% for flash_message in app.flashes('success') %}
			<div class="alert alert-success">{{ flash_message }}</div>
		{% endfor %}
		{% for flash_message in app.flashes('error') %}
			<div class="alert alert-danger">{{ flash_message }}</div>
		{% endfor %}

		<div class="card p-4 shadow-sm" style="max-width: 600px; margin: auto;">
			<p>
				<strong>De :</strong>
                {{ message.sender.pseudo }}
                {% if message.sender.pseudo == '[ROLE_ADMIN]' %}
                    <span class="badge-admin">ADMIN</span>
                {% endif %}
                    ({{ message.sender.email }})
			</p>
			<p>
				<strong>Statut :</strong>
				{{ message.isRead() ? 'Lu' : 'Non lu' }}</p>
			<p>
				<strong>À :</strong>
				{{ message.receiver.pseudo }}
				({{ message.receiver.email }})</p>
			<p>
				<strong>Envoyé le :</strong>
				{{ message.createdAt|date('Y-m-d H:i') }}</p>
			<p>
				<strong>Contenu :</strong>
			</p>
			
			<div class="border p-3 mb-3 bg-light">{{ message.content }}</div>
			<form method="post" action="{{ path('read-message', {'id': message.id}) }}">
				<input type="hidden" name="_token" value="{{ csrf_token('read_message_' ~ message.id) }}">
				<div class="form-check form-switch mb-2">
					<input class="form-check-input" type="checkbox" id="isReadSwitch" name="isRead" value="1" onchange="this.form.submit()" {% if message.isRead() %} checked disabled {% endif %}>
					<label class="form-check-label ms-2" for="isReadSwitch" style="font-weight:bold;">
						{% if message.isRead() %}
							Message lu
						{% else %}
							Marquer comme lu
						{% endif %}
					</label>
				</div>
				<a href="{{ path('list-messages') }}" class="btn btn-primary">Retour à la liste</a>
			</form>
		</div>
    </div>            
	{% endblock main %}
